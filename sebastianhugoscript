-- LocalScript in StarterPlayerScripts

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer

local function createGUI()
    local oldGui = player:WaitForChild("PlayerGui"):FindFirstChild("StatsGUI")
    if oldGui then oldGui:Destroy() end

    local PlayerGui = player:WaitForChild("PlayerGui")
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "StatsGUI"
    screenGui.Parent = PlayerGui

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 300, 0, 320)
    frame.Position = UDim2.new(0, 20, 0, 20)
    frame.BackgroundColor3 = Color3.new(0,0,0)
    frame.BackgroundTransparency = 0.2
    frame.BorderSizePixel = 0
    frame.Active = true
    frame.Draggable = true
    frame.Parent = screenGui

    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1,0,0,30)
    title.Position = UDim2.new(0,0,0,0)
    title.BackgroundTransparency = 1
    title.Text = "Player Stats"
    title.TextColor3 = Color3.new(1,1,1)
    title.Font = Enum.Font.SourceSansBold
    title.TextSize = 20
    title.Parent = frame

    -- WalkSpeed box
    local speedBox = Instance.new("TextBox")
    speedBox.Size = UDim2.new(1,-10,0,25)
    speedBox.Position = UDim2.new(0,5,0,40)
    speedBox.BackgroundColor3 = Color3.new(0.2,0.2,0.2)
    speedBox.TextColor3 = Color3.new(1,1,1)
    speedBox.Font = Enum.Font.SourceSans
    speedBox.TextSize = 18
    speedBox.PlaceholderText = "WalkSpeed = 16"
    speedBox.Text = "16"
    speedBox.ClearTextOnFocus = false
    speedBox.Parent = frame

    -- JumpPower box
    local jumpBox = Instance.new("TextBox")
    jumpBox.Size = UDim2.new(1,-10,0,25)
    jumpBox.Position = UDim2.new(0,5,0,75)
    jumpBox.BackgroundColor3 = Color3.new(0.2,0.2,0.2)
    jumpBox.TextColor3 = Color3.new(1,1,1)
    jumpBox.Font = Enum.Font.SourceSans
    jumpBox.TextSize = 18
    jumpBox.PlaceholderText = "JumpPower = 50"
    jumpBox.Text = "50"
    jumpBox.ClearTextOnFocus = false
    jumpBox.Parent = frame

    -- Fly speed box
    local flyBox = Instance.new("TextBox")
    flyBox.Size = UDim2.new(1,-10,0,25)
    flyBox.Position = UDim2.new(0,5,0,110)
    flyBox.BackgroundColor3 = Color3.new(0.2,0.2,0.2)
    flyBox.TextColor3 = Color3.new(1,1,1)
    flyBox.Font = Enum.Font.SourceSans
    flyBox.TextSize = 18
    flyBox.PlaceholderText = "Fly Speed = 50"
    flyBox.Text = "50"
    flyBox.ClearTextOnFocus = false
    flyBox.Parent = frame

    -- Labels
    local speedLabel = Instance.new("TextLabel")
    speedLabel.Size = UDim2.new(1,-10,0,25)
    speedLabel.Position = UDim2.new(0,5,0,145)
    speedLabel.BackgroundTransparency = 1
    speedLabel.TextColor3 = Color3.new(1,1,1)
    speedLabel.Font = Enum.Font.SourceSans
    speedLabel.TextSize = 18
    speedLabel.TextXAlignment = Enum.TextXAlignment.Left
    speedLabel.Text = "Current WalkSpeed: 16"
    speedLabel.Parent = frame

    local jumpLabel = Instance.new("TextLabel")
    jumpLabel.Size = UDim2.new(1,-10,0,25)
    jumpLabel.Position = UDim2.new(0,5,0,170)
    jumpLabel.BackgroundTransparency = 1
    jumpLabel.TextColor3 = Color3.new(1,1,1)
    jumpLabel.Font = Enum.Font.SourceSans
    jumpLabel.TextSize = 18
    jumpLabel.TextXAlignment = Enum.TextXAlignment.Left
    jumpLabel.Text = "Current JumpPower: 50"
    jumpLabel.Parent = frame

    -- Fly toggle
    local flyButton = Instance.new("TextButton")
    flyButton.Size = UDim2.new(1,-10,0,25)
    flyButton.Position = UDim2.new(0,5,0,195)
    flyButton.BackgroundColor3 = Color3.new(0.3,0.3,0.3)
    flyButton.TextColor3 = Color3.new(1,1,1)
    flyButton.Font = Enum.Font.SourceSans
    flyButton.TextSize = 18
    flyButton.Text = "Fly: OFF"
    flyButton.Parent = frame

    -- Teleport TextBox
    local tpBox = Instance.new("TextBox")
    tpBox.Size = UDim2.new(1,-10,0,25)
    tpBox.Position = UDim2.new(0,5,0,235)
    tpBox.BackgroundColor3 = Color3.new(0.2,0.2,0.2)
    tpBox.TextColor3 = Color3.new(1,1,1)
    tpBox.Font = Enum.Font.SourceSans
    tpBox.TextSize = 18
    tpBox.PlaceholderText = "Player name to teleport"
    tpBox.Text = ""
    tpBox.ClearTextOnFocus = false
    tpBox.Parent = frame

    -- Teleport Button
    local tpButton = Instance.new("TextButton")
    tpButton.Size = UDim2.new(1,-10,0,25)
    tpButton.Position = UDim2.new(0,5,0,270)
    tpButton.BackgroundColor3 = Color3.new(0.3,0.4,0.7)
    tpButton.TextColor3 = Color3.new(1,1,1)
    tpButton.Font = Enum.Font.SourceSansBold
    tpButton.TextSize = 18
    tpButton.Text = "Teleport"
    tpButton.Parent = frame

    return {
        speedBox = speedBox,
        jumpBox = jumpBox,
        flyBox = flyBox,
        speedLabel = speedLabel,
        jumpLabel = jumpLabel,
        flyButton = flyButton,
        tpBox = tpBox,
        tpButton = tpButton
    }
end

local flying = false

local function onCharacterAdded(character)
    local humanoid = character:WaitForChild("Humanoid")
    local root = character:WaitForChild("HumanoidRootPart")
    local animator = humanoid:FindFirstChildOfClass("Animator")

    humanoid.WalkSpeed = 16
    humanoid.JumpPower = 50

    local gui = createGUI()
    local speedBox, jumpBox, flyBox, speedLabel, jumpLabel, flyButton, tpBox, tpButton =
        gui.speedBox, gui.jumpBox, gui.flyBox, gui.speedLabel, gui.jumpLabel, gui.flyButton, gui.tpBox, gui.tpButton

    flying = false
    local savedAnim = nil

    -- Fly toggle
    flyButton.MouseButton1Click:Connect(function()
        flying = not flying
        flyButton.Text = flying and "Fly: ON" or "Fly: OFF"

        if flying then
            if animator then
                savedAnim = {}
                for _, track in pairs(animator:GetPlayingAnimationTracks()) do
                    track:Stop()
                    table.insert(savedAnim, track)
                end
            end

            humanoid:ChangeState(Enum.HumanoidStateType.Physics)

            if not root:FindFirstChild("FlyVelocity") then
                local bv = Instance.new("BodyVelocity")
                bv.Name = "FlyVelocity"
                bv.MaxForce = Vector3.new(1e5,1e5,1e5)
                bv.Velocity = Vector3.new(0,0,0)
                bv.Parent = root
            end
        else
            if root:FindFirstChild("FlyVelocity") then
                root.FlyVelocity:Destroy()
            end

            if animator and savedAnim then
                for _, track in pairs(savedAnim) do
                    track:Play()
                end
                savedAnim = nil
            end

            humanoid:ChangeState(Enum.HumanoidStateType.Running)
        end
    end)

    -- Teleport logic
    tpButton.MouseButton1Click:Connect(function()
        local targetName = tpBox.Text
        if targetName == "" then return end

        for _, plr in ipairs(Players:GetPlayers()) do
            if string.lower(plr.Name):sub(1, #targetName) == string.lower(targetName) then
                if plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                    root.CFrame = plr.Character.HumanoidRootPart.CFrame + Vector3.new(0, 3, 0)
                end
            end
        end
    end)

    RunService.RenderStepped:Connect(function()
        if humanoid.Health <= 0 then return end

        local speed = tonumber(speedBox.Text) or 16
        local jumpPower = tonumber(jumpBox.Text) or 50
        local flySpeed = tonumber(flyBox.Text) or 50

        humanoid.WalkSpeed = speed
        humanoid.JumpPower = jumpPower
        speedLabel.Text = "Current WalkSpeed: "..speed
        jumpLabel.Text = "Current JumpPower: "..jumpPower

        if flying and root:FindFirstChild("FlyVelocity") then
            local cam = workspace.CurrentCamera
            local moveDir = Vector3.new()

            if UserInputService:IsKeyDown(Enum.KeyCode.W) then moveDir += cam.CFrame.LookVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.S) then moveDir -= cam.CFrame.LookVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.A) then moveDir -= cam.CFrame.RightVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.D) then moveDir += cam.CFrame.RightVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.Space) then moveDir += Vector3.new(0,1,0) end
            if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then moveDir -= Vector3.new(0,1,0) end

            root.FlyVelocity.Velocity =
                moveDir.Magnitude > 0 and moveDir.Unit * flySpeed or Vector3.zero
        end
    end)
end

player.CharacterAdded:Connect(onCharacterAdded)
if player.Character then onCharacterAdded(player.Character) end
